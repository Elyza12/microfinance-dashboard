<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Borrowers</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<h1 class="text-center mt-5">Borrowers Page</h1>
<p class="text-center">List of all borrowers.</p>

<div class="container mt-4">
  <div class="mb-3">
    <input type="text" id="searchBorrower" class="form-control" placeholder="Search borrower by name or ID">
</div>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Borrower ID</th>
        <th>Full Name</th>
        <th>Status</th>
        <th>Contact</th>
      </tr>
    </thead>
    <tbody id="borrowersTable">
      <!-- Data will be filled dynamically -->
    </tbody>
  </table>
</div>

<p class="text-center">We will populate this with your borrowers list later.</p>
  <script>
    
const API_URL = "https://script.google.com/macros/s/AKfycbzJPQZw9vc81-X2GzYKUB44tk7q7IJQJG7lfmVG8mAnjcBOED0Jn700WmH13-Zv2ZJTDQ/exec";

// Redirect to login if not logged in
if(localStorage.getItem("loggedIn") !== "true"){
    window.location.href = "login.html";
}
// Search/filter functionality
document.getElementById("searchBorrower").addEventListener("input", function() {
    const searchTerm = this.value.toLowerCase();
    const rows = document.querySelectorAll("#borrowersTable tr");

    rows.forEach(row => {
        const id = row.cells[0].innerText.toLowerCase();
        const name = row.cells[1].innerText.toLowerCase();
        if(id.includes(searchTerm) || name.includes(searchTerm)) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
});

// Function to fetch borrowers
async function fetchBorrowers() {
    try {
        const response = await fetch(`${API_URL}?action=borrowers`);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error("Error fetching borrowers:", error);
        return [];
    }
}

// Function to fill table
async function fillBorrowersTable() {
    const borrowers = await fetchBorrowers();
    const table = document.getElementById("borrowersTable");

    // Clear existing rows
    table.innerHTML = "";

    // Add each borrower as a row
    borrowers.forEach(b => {
        const row = `
            <tr>
                <td>${b.BorrowerID}</td>
                <td>${b.FullName}</td>
                <td>${b.Status}</td>
                <td>${b.Contact || ""}</td>
            </tr>
        `;
        table.innerHTML += row;
    });
}

// Run the function when page loads
fillBorrowersTable();
</script>

</body>
</html>
