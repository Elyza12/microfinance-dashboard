<!DOCTYPE html>
<html>
<head>
<title>Microfinance Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
<h2>Dashboard</h2>

<div class="row mt-4">

<div class="col-md-3">
<div class="card bg-primary text-white">
<div class="card-body">
<h5>Total Loans</h5>
<h3 id="totalLoans">0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card bg-success text-white">
<div class="card-body">
<h5>Active Loans</h5>
<h3 id="activeLoans">0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card bg-danger text-white">
<div class="card-body">
<h5>Overdue Loans</h5>
<h3 id="overdueLoans">0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card bg-warning text-dark">
<div class="card-body">
<h5>Today's Collection</h5>
<h3 id="todayCollection">₱0.00</h3>
</div>
</div>
</div>

</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzJPQZw9vc81-X2GzYKUB44tk7q7IJQJG7lfmVG8mAnjcBOED0Jn700WmH13-Zv2ZJTDQ/exec";

async function loadDashboard(){
const loansRes = await fetch(`${API_URL}?action=loans`);
const loans = await loansRes.json();

const paymentsRes = await fetch(`${API_URL}?action=payments`);
let payments = [];
try { payments = await paymentsRes.json(); } catch {}

let total=0, active=0, overdue=0;
loans.forEach(l=>{
total++;
if(l.Status==="Active") active++;
if(l.Status==="Overdue") overdue++;
});

let todayTotal=0;
const today = new Date().toDateString();
payments.forEach(p=>{
if(new Date(p[3]).toDateString()===today){
todayTotal += Number(p[2])||0;
}
});

document.getElementById("totalLoans").innerText=total;
document.getElementById("activeLoans").innerText=active;
document.getElementById("overdueLoans").innerText=overdue;
document.getElementById("todayCollection").innerText="₱"+todayTotal.toFixed(2);
}

loadDashboard();
</script>

</body>
</html>
